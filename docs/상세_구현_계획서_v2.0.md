# 한국 은행 개인 신용평가 시스템 (KCS)
# 상세 구현 계획서 v2.0

**문서 번호**: KCS-IMP-2026-002
**버전**: v2.0
**작성일**: 2026-02-27
**기준 문서**:
- 상세 요건 정의서 v1.1 (KCS-SRS-2026-001)
- deep-research-report.md (외부 전문가 검토)
- 차세대 신용평가 시스템 개선 방안 도출.docx (업계 벤치마크)

**기밀 등급**: 대외비 (내부 배포)

---

## 목차

1. [비전 및 핵심 설계 원칙](#1-비전-및-핵심-설계-원칙)
2. [아키텍처 설계 결정 (ADR)](#2-아키텍처-설계-결정)
3. [기술 스택](#3-기술-스택)
4. [팀 구성 및 RACI](#4-팀-구성-및-raci)
5. [개발 방법론](#5-개발-방법론)
6. [최종 디렉토리 구조](#6-최종-디렉토리-구조)
7. [Phase별 구현 계획](#7-phase별-구현-계획)
8. [핵심 컴포넌트 코드 구조](#8-핵심-컴포넌트-코드-구조)
9. [마일스톤 및 대금 지급](#9-마일스톤-및-대금-지급)
10. [리스크 레지스터](#10-리스크-레지스터)
11. [KPI 측정 계획](#11-kpi-측정-계획)

---

## 1. 비전 및 핵심 설계 원칙

### 1.1 시스템 비전

> 시중은행이 인터넷전문은행과의 CSS 경쟁에서 압도하기 위한
> **건전성·수익성·소비자보호 3축 균형의 지능형 여신 의사결정 플랫폼**

본 시스템은 단순한 여신 심사 자동화 도구가 아니다. 다음 4개 역할을 동시에 수행한다.

| 역할 | 설명 |
|------|------|
| **유연한 규제 플랫폼** | DSR/LTV 등 거시건전성 규제 변경 시 무배포·당일 적용 |
| **대안 데이터 전초기지** | SOHO·씬파일러 대상 카드 가맹점·VAN·플랫폼 데이터 융합 |
| **AI 통제 타워** | 감사 로그 무결성, HSM 키관리, XAI 설명, 이의제기 프로세스 |
| **수익 최적화 엔진** | RAROC 기반 동적 프라이싱, EWS 연계 조기경보, NPL 회수 예측 |

### 1.2 핵심 설계 원칙

| 원칙 | 내용 | 비고 |
|------|------|------|
| **P1: 규제 우선** | 하드컷은 어떤 경우에도 우회 불가. 심사관도 재정의 불가 | 모든 규제 로직 BRMS 테이블 기반 |
| **P2: 섀도우 강제** | 챌린저 모델은 Shadow 모드에서만 검증. 라이브 A/B 금지 | 금소법 §19 위반 방지 |
| **P3: 추적성 완전** | 모든 평가 건: 피처 스냅샷 + 스코어 + 결정 사유 5년 보존 | Kafka at-least-once |
| **P4: 칼리브레이션 우선** | Gini가 높더라도 ECE > 0.02면 모델 재보정 필수 | 한도·금리 정확성 담보 |
| **P5: 수익성 연동** | 모든 신규 대출 건 실시간 RAROC 산출 → 가격 정책 입력 | RW 상품별 차등 |

---

## 2. 아키텍처 설계 결정

### 2.1 ADR-001: BRMS 기반 동적 정책 관리

**문제**: 스트레스 DSR Phase 3 기준으로 변동금리·혼합형·주기형·순수고정금리별 적용 비율이 40%/80%/100%로 복잡하게 차등 적용되며, 지역·상품·만기·소득 조건별 예외가 빈번히 변경된다.

**결정**: 모든 규제 산식 파라미터를 `regulation_params` 이력 테이블에 분리 관리하는 **경량 BRMS (Lightweight Policy Engine)** 구축.

```
[BRMS 레이어 구성]
┌─────────────────────────────────────────────────────┐
│  PolicyEngine (Python)                              │
│  ┌──────────────┐  ┌───────────────┐               │
│  │ PolicyLoader │  │ RuleEvaluator │               │
│  │ (Redis캐시)  │  │ (조건 트리)   │               │
│  └──────────────┘  └───────────────┘               │
│         ↑                  ↑                        │
│  regulation_params    policy_conditions             │
│  (PostgreSQL 이력테이블)  (JSONB 조건 매트릭스)     │
└─────────────────────────────────────────────────────┘
```

**스트레스 DSR Phase 3 정책 테이블 예시**:

```
param_key              | value  | effective_from | condition_json
-----------------------|--------|----------------|------------------------------------------
stress_rate_max        | 0.0150 | 2025-07-01     | {"institution": "bank"}
stress_apply_ratio     | 1.0    | 2025-07-01     | {"rate_type": "variable"}
stress_apply_ratio     | 0.8    | 2025-07-01     | {"rate_type": "mixed", "region": "metro"}
stress_apply_ratio     | 0.4    | 2025-07-01     | {"rate_type": "mixed", "region": "non_metro"}
stress_apply_ratio     | 0.0    | 2025-07-01     | {"rate_type": "fixed", "maturity_years_gte": 3}
```

**효과**: 규제 변경 반영 리드타임 14일 → 1영업일 이내

### 2.2 ADR-002: SOHO 이중 구조 모형 (Dual-Track Scoring)

**문제**: 전통적 재무제표 기반 SOHO 평가는 업력 짧은 우량 사업자를 구조적으로 배제한다. 인터넷전문은행(케이뱅크·카카오뱅크)은 카드 가맹점 매출·플랫폼 데이터로 이를 역이용 중이다.

**결정**: 주 모형(Application Scorecard) + 업종별 하위 모형(Sub-model) 앙상블 구조.

```
SOHO 평가 흐름
  ┌─────────────────────────────────┐
  │ Main Scorecard (재무 + CB 데이터) │
  │ → PD_main                        │
  └─────────────────┬───────────────┘
                    ↓
  ┌─────────────────────────────────┐
  │ AltData Sub-model (업종별)      │
  │ 음식점: 배달 매출 + 카드 가맹점  │
  │ IT서비스: 플랫폼 수익 + 계약 수 │
  │ 소매업: VAN 일 매출 패턴        │
  │ → PD_alt                        │
  └─────────────────┬───────────────┘
                    ↓
  앙상블: PD_final = α × PD_main + (1-α) × PD_alt
  α = 0.7 (기본), α 조정은 IRG·업력·데이터 가용성 기반
```

### 2.3 ADR-003: CB Circuit Breaker + Fail-over

**문제**: 단일 CB사 의존 시 장애 발생 시 전면 영업 중단 위험.

**결정**: 3단계 Fail-over 아키텍처.

```
Stage 1: 주 CB (NICE) → 정상 심사
Stage 2: 보조 CB (KCB) → 주 CB 장애 시 자동 전환 (Circuit Breaker trip 조건: 5초 내 3회 타임아웃)
Stage 3: 내부 대체 심사 모드 (Alt-Mode) → 양쪽 CB 모두 장애 시
  - 사용 데이터: 마이데이터 잔액·거래 이력 + CBS 계좌 데이터 + 이전 CB 캐시(최대 30일)
  - 적용 한도: 정상 한도의 70%로 자동 감액
  - 심사 결과에 'ALT_MODE' 플래그 → 리스크팀 자동 알림
```

### 2.4 ADR-004: 이벤트 기반 EWS 양방향 통합

**문제**: 대출 실행 후 차주 재무 상태 악화를 조기 감지하는 채널이 없다.

**결정**: Kafka 기반 이벤트 스트림으로 CSS ↔ EWS 실시간 양방향 통합.

```
EWS → CSS (부실 징후 수신):
  Event: "ews.warning.triggered"
  Payload: {applicant_id, warning_type, severity, triggered_at}
  CSS 처리:
    severity=RED   → 기한이익상실 자동 검토 + 리스크팀 알림
    severity=AMBER → 차기 연장 시 등급 하향 예약 + 가산금리 예약
    severity=YELLOW → 모니터링 강화 플래그

CSS → EWS (신규 대출 정보 제공):
  Event: "css.loan.executed"
  Payload: {applicant_id, loan_id, pd, lgd, ead, irg, eq_grade}
```

### 2.5 ADR-005: 동적 CCF 추정 엔진

**문제**: 한도대출(마이너스통장)의 CCF를 50% 고정값으로 처리하면 EAD 왜곡 → RAROC 산출 오류.

**결정**: LightGBM 기반 CCF 추정 모형, 12개월 롤링 업데이트.

```
CCF 추정 입력 변수:
  - 한도 소진율 Velocity (최근 3/6/12개월 변화율)
  - 차주 신용점수 변화 추이
  - 기준금리 수준
  - IRG 등급
  - 고용주 EQ 등급
  - 거시경제 지표 (CD91일물 금리, 실업률)

CCF 모형 출력: CCF_predicted ∈ [0.0, 1.0]
EAD = 잔액 + CCF_predicted × 미사용 한도
```

---

## 3. 기술 스택

| 구분 | 기술 선택 | 선택 이유 |
|------|---------|---------|
| **Backend API** | FastAPI 0.111+ (async) | 고성능 비동기, Pydantic v2 타입 안전성 |
| **BRMS** | Custom PolicyEngine (Python + PostgreSQL JSONB) | 외부 BRMS 라이선스 비용 회피, 완전 통제 |
| **ML 추론** | LightGBM 4.x + SHAP 0.46 | 속도·성능·SHAP 네이티브 지원 |
| **CCF 모형** | LightGBM (별도 모델 레지스트리 등록) | 스코어카드와 동일 파이프라인 재활용 |
| **데이터베이스** | PostgreSQL 16 (파티셔닝) | audit_logs 월별 파티션, JSONB 정책 관리 |
| **캐시** | Redis 7.2 (Sentinel) | PolicyEngine 캐시, 세션, EQ 등급 캐시 |
| **메시지 큐** | Apache Kafka 3.7 | 감사 로그 at-least-once, EWS 이벤트 |
| **모니터링** | Prometheus + Grafana + Alertmanager | PSI·빈티지·RAROC 대시보드 |
| **MLOps** | MLflow 2.14 + DVC | 모델 레지스트리, 실험 추적, 데이터 버전 |
| **CI/CD** | GitHub Actions + Docker + Blue-Green | 무중단 배포, 자동 골든케이스 테스트 |
| **보안** | HashiCorp Vault (KMS 역할) | HSM 소프트웨어 대체, HMAC 키 관리 |
| **대안 데이터** | REST Adapter 마이크로서비스 | VAN/PG/배달플랫폼 API 표준화 |

> **HashiCorp Vault 선택 이유**: 물리 HSM 도입 전 검증용으로 Vault를 KMS로 사용. HMAC 키를 Vault Transit Secrets Engine에 저장하여 애플리케이션 코드에서 완전 분리. 추후 물리 HSM으로 마이그레이션 경로 확보.

---

## 4. 팀 구성 및 RACI

| 역할 | 인원 | 주요 담당 |
|------|------|---------|
| **아키텍처 리드** | 1 | 전체 설계 결정, 기술 검토, ADR 관리 |
| **ML 엔지니어** | 4 | Application/Behavioral/Collection Scorecard, CCF 모형, SOHO 대안 모형 |
| **백엔드 개발자** | 4 | PolicyEngine, 평가 엔진, 프라이싱 엔진, REST API |
| **데이터 엔지니어** | 2 | 대안 데이터 파이프라인, 피처 스토어, EWS 통합 |
| **DB 엔지니어** | 1 | 파티셔닝 설계, 성능 튜닝, 마이그레이션 |
| **DevOps** | 2 | CI/CD, Kubernetes, 모니터링 인프라 |
| **보안 전문가** | 1 | Vault 키 관리, ISMS-P 대응, Red Team 테스트 |
| **QA 엔지니어** | 2 | 규제 준수 테스트, 자동화 E2E, 성능 테스트 |
| **총계** | **17명** | |

**RACI 요약**:

| 작업 | 아키텍처 | ML | 백엔드 | 데이터 | 보안 | QA |
|------|---------|-----|-------|-------|------|-----|
| BRMS 설계 | A | I | R | I | C | C |
| 스코어카드 개발 | C | R | I | C | I | A |
| PolicyEngine 구현 | A | C | R | I | C | C |
| Vault KMS 연동 | C | I | C | I | R | A |
| EWS 통합 | A | I | C | R | I | C |
| Red Team 테스트 | A | I | I | I | R | C |

---

## 5. 개발 방법론

**Structured Iterative Delivery (SID)**

- 전체 구조: Waterfall Phase 게이트 (Phase 간 품질 게이트 통과 후 진행)
- 내부 실행: 2주 스프린트 (Scrum)
- 품질 게이트: Phase 완료 시 리스크팀·컴플라이언스·보안 3자 검토 후 진행 승인

**2트랙 병렬 진행**:
- **Track A (핵심)**: BRMS + 기본 스코어카드 + 평가 엔진 + API → Release 1 (12개월)
- **Track B (확장)**: 대안 데이터 + CCF ML + EWS + 포트폴리오 스트레스 테스트 → Release 2 (15개월)

---

## 6. 최종 디렉토리 구조

```
korea-credit-scoring/
├── backend/
│   └── app/
│       ├── api/
│       │   ├── v1/
│       │   │   ├── score.py           # POST /api/v1/score
│       │   │   ├── applications.py    # CRUD
│       │   │   ├── monitoring.py      # PSI, RAROC, vintage
│       │   │   ├── audit.py           # 감사 로그 조회
│       │   │   ├── admin/
│       │   │   │   ├── params.py      # 규제 파라미터 관리
│       │   │   │   └── models.py      # 모델 업로드/배포
│       │   │   └── appeals.py         # 이의제기 처리 (FR-EXP-003~004)
│       │   └── deps.py                # RBAC 의존성 주입
│       ├── core/
│       │   ├── policy_engine.py       # BRMS PolicyEngine (ADR-001)
│       │   ├── scoring_engine.py      # 평가 오케스트레이터
│       │   ├── hard_cut_engine.py     # 하드컷 규제 실행기
│       │   ├── limit_calculator.py    # Track별 한도 산출
│       │   ├── pricing_engine.py      # RAROC 기반 금리 산정
│       │   ├── rate_breakdown.py      # 대출금리 산정내역서 생성
│       │   ├── ccf_engine.py          # 동적 CCF 추정 (ADR-005)
│       │   ├── explanation_engine.py  # SHAP → 한국어 설명
│       │   ├── cb_client.py           # Circuit Breaker 포함 CB 클라이언트
│       │   ├── cb_failover.py         # 3단계 Fail-over (ADR-003)
│       │   └── alt_mode_scorer.py     # CB 전면 장애 시 내부 대체 심사
│       ├── models/
│       │   ├── registry.py            # MLflow 기반 챔피언/챌린저 레지스트리
│       │   ├── shadow_engine.py       # Shadow 병렬 실행 엔진 (ADR-002)
│       │   └── calibration.py         # Platt/Isotonic 보정, ECE 계산
│       ├── monitoring/
│       │   ├── psi_calculator.py      # Score/Feature/Target PSI 3종
│       │   ├── vintage_analyzer.py    # 빈티지/코호트 분석 (FR-MON-004)
│       │   ├── calibration_monitor.py # Brier·ECE 분기별 측정 (FR-MON-005)
│       │   └── raroc_monitor.py       # 포트폴리오 RAROC 모니터링
│       ├── ews/
│       │   ├── consumer.py            # Kafka EWS 이벤트 소비
│       │   ├── publisher.py           # CSS → EWS 이벤트 발행
│       │   └── action_dispatcher.py   # severity별 자동 대응 (ADR-004)
│       ├── stress_test/
│       │   └── portfolio_simulator.py # 포트폴리오 스트레스 테스트
│       ├── security/
│       │   ├── crypto_service.py      # Vault 연동 HMAC + AES-256-GCM
│       │   ├── key_rotation.py        # 키 회전 절차
│       │   └── audit_logger.py        # Kafka at-least-once 감사 로그
│       ├── db/
│       │   ├── schemas/               # SQLAlchemy 모델
│       │   ├── migrations/            # Alembic 마이그레이션
│       │   └── session.py
│       └── config.py                  # 정적 설정 (동적 규제값은 BRMS)
│
├── ml_pipeline/
│   ├── data/
│   │   ├── synthetic_data.py          # 합성 데이터 생성
│   │   └── alt_data_simulator.py      # 대안 데이터 시뮬레이터
│   ├── features/
│   │   ├── feature_store.py           # 피처 정의 + 버전 관리
│   │   ├── woe_encoder.py             # WOE/IV 변환
│   │   └── alt_features.py            # 대안 데이터 피처 엔지니어링
│   ├── training/
│   │   ├── train_application.py       # Application Scorecard
│   │   ├── train_behavioral.py        # Behavioral Scorecard
│   │   ├── train_collection.py        # Collection Scorecard (NPL 회수)
│   │   ├── train_ccf.py               # CCF 동적 추정 모형
│   │   ├── train_soho_altdata.py      # SOHO 대안 데이터 하위 모형
│   │   └── train_thinfile.py          # 씬파일러 모형 (Phase 2)
│   └── validation/
│       ├── model_validator.py         # Gini·KS·Brier·ECE·PSI 통합 검증
│       ├── fairness_checker.py        # Equal Opportunity Gap 검증
│       └── vintage_backtest.py        # 빈티지 사후 검증
│
├── alt_data/
│   ├── adapters/
│   │   ├── card_merchant_adapter.py   # 카드 가맹점 매출 (삼성·신한카드)
│   │   ├── van_pg_adapter.py          # VAN/PG 일 매출 집계
│   │   ├── delivery_platform_adapter.py # 배달 플랫폼 매출
│   │   └── mydata_adapter.py          # 마이데이터 계좌 거래 이력
│   └── pipeline/
│       ├── soho_data_pipeline.py      # SOHO 대안 데이터 수집 파이프라인
│       └── thinfile_pipeline.py       # 씬파일러 비금융 데이터 파이프라인
│
├── validation/
│   └── roles/
│       ├── developer/
│       │   └── test_model_performance.py  # DEV-01~15
│       ├── risk_management/
│       │   ├── test_risk_profitability.py # RISK-01~13
│       │   └── test_vintage_analysis.py   # RISK-14~18 (빈티지)
│       ├── compliance/
│       │   ├── test_regulatory_compliance.py  # TC-REG-001~014
│       │   ├── test_regulatory_validation.py  # 골든케이스 회귀테스트
│       │   └── test_brms_policy.py            # BRMS 정책 전환 테스트
│       └── security/
│           ├── test_pii_protection.py    # TC-SEC-001~006
│           └── test_adversarial.py       # AI Red Team 테스트
│
├── docs/
│   ├── adr/                           # Architecture Decision Records
│   ├── mrm/                           # Model Risk Management Documents
│   └── runbooks/                      # 운영 런북
│
└── infra/
    ├── docker-compose.yml
    ├── kubernetes/
    │   ├── blue-green/
    │   └── kafka/
    └── vault/                         # HashiCorp Vault 설정
```

---

## 7. Phase별 구현 계획

**전체 일정**: 2026-04-01 ~ 2027-09-30 (18개월)

### Phase 0: 킥오프 + 플랫폼 구축 (4주, 2026.04)

**목표**: 개발 인프라, DB 스키마, BRMS 기초 구조 완성

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S1 (W1-2) | Jira·GitHub·Docker·Kafka·Vault 환경 구축, DB 스키마 초안 |
| S2 (W3-4) | `regulation_params` 이력 테이블 설계, 초기 Phase 3 데이터 입력, Vault Transit Secrets Engine 설정 |

**Phase 0 완료 기준 (품질 게이트)**:
- 모든 개발자 로컬 환경 실행 확인
- DB 마이그레이션 1회 성공
- Vault 연동 HMAC 테스트 통과
- regulation_params에 Phase 1~3 스트레스 DSR 파라미터 등록 확인

---

### Phase 1: ML 파이프라인 (10주, 2026.05~07)

**목표**: 5종 스코어카드 + CCF 모형 학습·검증 완료

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S3-4 | Application Scorecard (Track-S/B/P 분리), WOE/IV, LightGBM, SHAP |
| S5-6 | Behavioral Scorecard (XGBoost), Collection Scorecard (RF + LightGBM) |
| S7-8 | CCF 동적 추정 모형 (LightGBM), 합성 데이터 EAD/CCF 레이블 생성 |
| S9-10 | 모델 통합 검증 (Gini, Brier, ECE, PSI, 공정성), MRM 초안 문서화 |

**MLflow 모델 등록 체계**:
```
모델명                  | 버전 | 상태      | 배포 환경
------------------------|------|-----------|----------
application_salaried    | v1.0 | Champion  | production
application_business    | v1.0 | Champion  | production
behavioral_all          | v1.0 | Champion  | production
collection_all          | v1.0 | Champion  | production
ccf_credit_line         | v1.0 | Champion  | production
```

**Phase 1 완료 기준**:
- Application Scorecard OOT Gini ≥ 0.30
- ECE ≤ 0.02 (칼리브레이션)
- Score PSI (학습/검증 기간) < 0.10
- 공정성: 연령대별 Equal Opportunity Gap ≤ 15%p

---

### Phase 2: 핵심 평가 엔진 (10주, 2026.07~09)

**목표**: BRMS PolicyEngine, 평가 오케스트레이터, RAROC 프라이싱 엔진 완성

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S11-12 | PolicyEngine 구현 (Redis 캐시, 효력일 전환, 골든케이스 테스트) |
| S13-14 | HardCutEngine (CB동의→미성년→체납→DSR→LTV 순서 강제), ScoringEngine 오케스트레이터 |
| S15-16 | LimitCalculator (Track-S/B/P, EQ·IRG 배수), Shadow 병렬 실행 엔진 |
| S17-18 | PricingEngine (RAROC 산출, 등급별 가산금리), RateBreakdownService (금리 산정내역서) |
| S19-20 | AuditLogger (Kafka at-least-once + RDBMS fallback), CryptoService (Vault 연동) |

**Phase 2 완료 기준**:
- TC-REG-001~014 전건 통과 (HardCutEngine)
- 골든케이스 회귀테스트 커버리지 ≥ 95%
- 파라미터 변경 후 다음 건에 즉시 반영 확인
- 감사 로그 누락율 0% (10,000건 부하 테스트)
- 챌린저 결과 고객 노출 건수 = 0 (Shadow 검증)

---

### Phase 3: REST API + XAI 프론트엔드 (8주, 2026.09~11)

**목표**: FastAPI 전체 엔드포인트, RBAC, 이의제기 워크플로우, XAI 설명 UI

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S21-22 | FastAPI 라우터 전체 (POST /score, GET /applications, PATCH /review 등) |
| S23-24 | RBAC 6개 역할 + JWT RS256 + MFA 관리자 연동 |
| S25-26 | FR-EXP-003~004: 이의제기 접수 API, 재산출 워크플로우, 10영업일 SLA 트래킹 |
| S27-28 | XAI 설명 API: SHAP Top-5 → 한국어 문장 변환 템플릿 (거절·승인·이의제기 설명 포함) |

**한국어 설명 템플릿 예시**:
```python
TEMPLATES = {
    "cb_score_low": "신용평가사(CB) 점수({value}점)가 낮아 신용점수에 {impact:+.0f}점 영향을 미쳤습니다.",
    "inquiry_count_3m": "최근 3개월 신용조회 횟수({value}회)가 평균({avg:.1f}회)보다 많아 {impact:+.0f}점 영향을 미쳤습니다.",
    "dsr_ratio_high": "총부채원리금상환비율(DSR)이 {value:.1f}%로, 기준({limit}%) 대비 {diff:.1f}%p 초과하여 한도가 제한되었습니다.",
    "revenue_decline": "전년 대비 매출이 {decline:.1f}% 감소하여 사업 안정성 평가에 영향을 미쳤습니다.",
    "business_age_short": "사업 개시 후 {months}개월로, 해당 업종(IRG-{irg}) 최소 요건({req}개월)에 미달합니다.",
}
```

**Phase 3 완료 기준**:
- P95 응답 시간 ≤ 500ms @ 200 TPS (운영 사양)
- RBAC 침해 테스트 전건 차단
- 이의제기 워크플로우 UAT 통과
- 한국어 설명에 영문 변수명 포함 건수 = 0

---

### Phase 4: 대안 데이터 파이프라인 + SOHO 이중 구조 모형 (8주, 2026.11~2027.01)

**목표**: SOHO 대안 데이터 수집, Sub-model 학습, 앙상블 통합 (Release 2 시작)

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S29-30 | 카드 가맹점 API Adapter, VAN/PG 일 매출 집계 파이프라인 |
| S31-32 | 배달 플랫폼 API Adapter, 마이데이터 계좌 거래 패턴 피처 |
| S33-34 | SOHO 업종별 Sub-model 학습 (음식점·IT·소매업 각 별도), 앙상블 가중치 α 최적화 |
| S35-36 | 씬파일러 모형 (통신 요금·건보료·연금 납부 이력 기반), 통합 테스트 |

**대안 데이터 소득 인정 로직 (Phase 4 추가)**:
```python
ALT_INCOME_SOURCES = {
    "card_merchant": {
        "reliability": 0.90,
        "description": "카드 가맹점 일 매출 12개월 평균 × 업종 소득률",
        "priority": 2  # 국세청(1) 다음
    },
    "van_pg_sales": {
        "reliability": 0.85,
        "description": "VAN/PG 승인 내역 기반 월 매출 추정",
        "priority": 3
    },
    "delivery_platform": {
        "reliability": 0.80,
        "description": "배달플랫폼 월 매출 데이터",
        "priority": 3
    },
}
```

**Phase 4 완료 기준**:
- SOHO 대안 데이터 기반 승인율 기존 대비 +5%p 이상 (씬파일러 포용)
- 대안 데이터 파이프라인 일 갱신 성공률 ≥ 99%
- 앙상블 모형 OOT Gini ≥ 단일 모형 대비 +0.02

---

### Phase 5: EWS 통합 + NPL 회수 예측 + 스트레스 테스트 (8주, 2027.01~03)

**목표**: EWS 양방향 통합, 추심 모형 강화, 포트폴리오 스트레스 테스트 시뮬레이터

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S37-38 | EWS Kafka Consumer/Publisher (ADR-004), severity별 자동 대응 액션 |
| S39-40 | Collection Scorecard 강화: NPL 회수 난이도 1~10등급, 회수 예상 금액 시뮬레이터 |
| S41-42 | 포트폴리오 스트레스 테스트: 기준금리 +200bp, 부동산 -20% 시나리오별 EL·RAROC 시뮬레이션 |
| S43-44 | 백오피스 대시보드: 스트레스 테스트 결과, EWS 경보 현황, NPL 등급별 현황 |

**포트폴리오 스트레스 테스트 시나리오**:
```python
STRESS_SCENARIOS = {
    "base": {"rate_shock_bp": 0, "property_shock_pct": 0, "gdp_shock_pct": 0},
    "mild": {"rate_shock_bp": 100, "property_shock_pct": -10, "gdp_shock_pct": -1.5},
    "severe": {"rate_shock_bp": 200, "property_shock_pct": -20, "gdp_shock_pct": -3.0},
    "extreme": {"rate_shock_bp": 300, "property_shock_pct": -30, "gdp_shock_pct": -5.0},
}
# 각 시나리오: PD_stressed = PD_base × stress_multiplier(scenario)
# 산출: EL_stressed, RAROC_stressed, Capital_shortfall
```

**Phase 5 완료 기준**:
- EWS 이벤트 수신 후 5분 이내 CSS 자동 대응 확인
- NPL 회수 예측 모형 AUC ≥ 0.70
- 스트레스 테스트 4개 시나리오 자동 생성 확인

---

### Phase 6: 보안 강화 + AI Red Team 테스트 (6주, 2027.03~04)

**목표**: OWASP 취약점 0건, AI 적대적 공격 취약점 점검, ISMS-P 대응

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S45-46 | 제3자 보안 진단 (OWASP Top 10, SQL Injection, XSS) 지적사항 조치 |
| S47-48 | **AI Red Team 테스트**: 조작된 입력값으로 스코어 조작 시도, 피처 값 극단값 주입, 모델 추출(extraction) 공격 시뮬레이션 |
| S49-50 | 키 회전 절차 검증, Vault 가용성 테스트, ISMS-P 체크리스트 점검 |

**AI Red Team 테스트 항목 (금보원 AI 보안 가이드라인)**:

| 공격 유형 | 테스트 내용 | 합격 기준 |
|---------|-----------|---------|
| Adversarial Input | 입력값 미세 조작으로 D등급 → BBB 유도 시도 | 조작 성공 건수 = 0 |
| Feature Injection | API 입력에 허용되지 않은 피처 주입 | 검증 오류 반환, 모델 미실행 |
| Model Extraction | 반복 조회로 모델 역산 시도 | Rate Limit 차단, 비정상 패턴 알림 |
| Data Poisoning | 학습 데이터 오염 시나리오 | 데이터 검증 파이프라인 탐지 |

**Phase 6 완료 기준**:
- OWASP Critical/High 0건 (제3자 기관 발행 보고서)
- AI Red Team 모든 공격 시도 차단 또는 탐지 확인
- 주민번호 평문 노출 0건 (DB·로그·API 응답 전수 확인)

---

### Phase 7: 통합 테스트 + UAT (8주, 2027.04~06)

**목표**: TC-REG 전건 통과, 성능 테스트, UAT 현업 합격률 ≥ 95%

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S51-52 | 은행 컴플라이언스팀 주관 TC-REG-001~014 전건 테스트, BRMS 골든케이스 회귀테스트 |
| S53-54 | 성능 테스트: TC-PERF-001~005 (200 TPS 30분, 스파이크, CB 타임아웃) |
| S55-56 | UAT-001~010 현업(영업점·심사팀) 주관 시나리오 테스트 |
| S57-58 | 지적사항 조치, MRM 최종 문서화, 모델카드 JSON 생성, 납품 산출물 패키징 |

**Phase 7 완료 기준**:
- TC-REG-001~014 전건 합격 (컴플라이언스 팀장 서명)
- P95 ≤ 500ms @ 200 TPS (운영 사양 측정)
- UAT 현업 합격률 ≥ 95% (현업 팀장 서명)
- 이의제기 테스트 케이스 10영업일 내 처리율 100%

---

### Phase 8: 운영 이관 (4주, 2027.06~07)

**스프린트 계획**:

| Sprint | 작업 |
|--------|------|
| S59-60 | 은행 IT팀 KT (BRMS 파라미터 변경, 모델 재학습, Vault 키 회전, 장애 대응) |
| S61-62 | Blue-Green 배포 실전 훈련, DR Fail-over 훈련, 운영 매뉴얼 최종 인도 |

---

### Phase 9: 안정화 (3개월, 2027.07~09)

- 월별 PSI·빈티지·칼리브레이션 보고서 발행 확인
- P1 장애 대응 SLA (2시간 이내) 준수 확인
- EWS 이벤트 처리 정상 동작 확인
- 규제 파라미터 변경 발생 시 BRMS 골든케이스 재실행

---

## 8. 핵심 컴포넌트 코드 구조

### 8.1 PolicyEngine (BRMS)

```python
# backend/app/core/policy_engine.py
from datetime import date
from typing import Any
import json
import redis
from sqlalchemy.ext.asyncio import AsyncSession

class PolicyEngine:
    """
    동적 규제 파라미터 조회 엔진.
    Redis 캐시(TTL 5분) → PostgreSQL 이력 테이블 순으로 조회.
    효력일 기준 자동 전환 보장.
    """
    def __init__(self, redis_client: redis.Redis, db: AsyncSession):
        self._redis = redis_client
        self._db = db

    async def get_stress_dsr_rate(
        self,
        region: str,           # "metropolitan" | "non_metropolitan"
        rate_type: str,        # "variable" | "mixed" | "periodic" | "fixed"
        maturity_years: float,
        effective_date: date | None = None,
    ) -> float:
        """스트레스 DSR 적용 금리 = 기본 스트레스 금리 × 적용 비율"""
        ref_date = effective_date or date.today()
        cache_key = f"policy:stress_dsr:{region}:{rate_type}:{maturity_years}:{ref_date}"
        cached = self._redis.get(cache_key)
        if cached:
            return float(cached)

        # 기본 스트레스 금리 조회
        base_rate = await self._fetch_param(
            "stress_rate_max",
            {"institution": "bank"},
            ref_date,
        )
        # 적용 비율 조회 (금리 유형·지역·만기 조건)
        apply_ratio = await self._fetch_param(
            "stress_apply_ratio",
            {"rate_type": rate_type, "region": region, "maturity_years": maturity_years},
            ref_date,
        )
        result = base_rate * apply_ratio
        self._redis.setex(cache_key, 300, str(result))  # TTL 5분
        return result

    async def _fetch_param(
        self, param_key: str, conditions: dict, ref_date: date
    ) -> float:
        """
        regulation_params 이력 테이블에서 조건에 맞는 최신 유효 파라미터 조회.
        조건 매칭: condition_json이 입력 조건을 포함하는 행 중 가장 우선순위 높은 행 선택.
        """
        # JSONB 조건 매칭 쿼리 (구체적 조건이 일반 조건보다 우선)
        query = """
            SELECT param_value FROM regulation_params
            WHERE param_key = :key
              AND effective_from <= :date
              AND (effective_to IS NULL OR effective_to > :date)
              AND condition_json @> :conditions::jsonb
            ORDER BY jsonb_array_length(
                ARRAY(SELECT jsonb_object_keys(condition_json))::jsonb
            ) DESC
            LIMIT 1
        """
        result = await self._db.execute(
            query,
            {"key": param_key, "date": ref_date, "conditions": json.dumps(conditions)},
        )
        row = result.fetchone()
        if row is None:
            raise PolicyNotFoundError(
                f"No policy found for {param_key} with {conditions} on {ref_date}"
            )
        return float(row[0])
```

### 8.2 RAROC 기반 금리 산정 + 대출금리 산정내역서

```python
# backend/app/core/pricing_engine.py
from dataclasses import dataclass
from decimal import Decimal

@dataclass
class RateBreakdown:
    """금융소비자보호법 준거 대출금리 산정내역서"""
    base_rate: Decimal          # 기준금리 (COFIX 등)
    credit_spread: Decimal      # 신용가산금리 (PD·LGD·EAD 기반)
    funding_cost: Decimal       # 조달비용 (CD91일물 + 내부가산)
    operating_cost: Decimal     # 운영비용 (심사비 배분)
    eq_adjustment: Decimal      # EQ 등급 우대/가산
    relationship_discount: Decimal  # 급여이체·자동납부 우대
    final_rate: Decimal         # 최종 금리 (CAP: 20%)
    rate_capped: bool           # 최고금리 상한 적용 여부
    raroc_at_final_rate: Decimal  # 최종 금리 적용 시 RAROC
    hurdle_rate_satisfied: bool  # RAROC ≥ 12% 여부

class PricingEngine:
    def calculate(
        self,
        pd: float, lgd: float, ead: float,
        rw: float, eq_grade: str,
        relationship_flags: dict,
        base_rate: float,  # PolicyEngine에서 동적 조회
    ) -> RateBreakdown:
        # 기대손실 = PD × LGD × EAD
        el = Decimal(str(pd * lgd * ead))
        # 신용 원가 (연간 기대손실 / EAD)
        credit_cost_rate = Decimal(str(pd * lgd))
        # 경제자본 비용 = EAD × RW × 8% × 목표 자기자본이익률(12%)
        capital_cost_rate = Decimal(str(rw * 0.08 * 0.12))
        credit_spread = credit_cost_rate + capital_cost_rate

        eq_adj = self._eq_rate_adjustment(eq_grade)
        rel_disc = self._relationship_discount(relationship_flags)
        funding = Decimal("0.0080")
        operating = Decimal("0.0150")

        raw_rate = (Decimal(str(base_rate)) + credit_spread
                    + funding + operating + eq_adj - rel_disc)
        final = min(raw_rate, Decimal("0.2000"))

        # RAROC 검증
        raroc = self._calc_raroc(
            Decimal(str(pd)), Decimal(str(lgd)), Decimal(str(ead)),
            Decimal(str(rw)), final
        )
        return RateBreakdown(
            base_rate=Decimal(str(base_rate)),
            credit_spread=credit_spread,
            funding_cost=funding,
            operating_cost=operating,
            eq_adjustment=eq_adj,
            relationship_discount=rel_disc,
            final_rate=final,
            rate_capped=(raw_rate > Decimal("0.2000")),
            raroc_at_final_rate=raroc,
            hurdle_rate_satisfied=(raroc >= Decimal("0.12")),
        )

    def _calc_raroc(self, pd, lgd, ead, rw, rate) -> Decimal:
        interest_income = ead * rate
        funding_cost = ead * Decimal("0.0080")
        operating_cost = ead * Decimal("0.0150")
        expected_loss = pd * lgd * ead
        net_income = interest_income - funding_cost - operating_cost - expected_loss
        economic_capital = ead * rw * Decimal("0.08")
        if economic_capital == 0:
            return Decimal("0")
        return net_income / economic_capital
```

### 8.3 EWS 이벤트 소비자

```python
# backend/app/ews/consumer.py
from aiokafka import AIOKafkaConsumer
import json

class EWSConsumer:
    """
    EWS에서 발행하는 부실 징후 이벤트를 소비하여 CSS 자동 대응 실행.
    Topic: ews.warning.triggered
    """
    async def start(self):
        consumer = AIOKafkaConsumer(
            "ews.warning.triggered",
            bootstrap_servers="kafka:9092",
            group_id="css-ews-consumer",
            auto_offset_reset="earliest",
            enable_auto_commit=False,
        )
        await consumer.start()
        try:
            async for msg in consumer:
                event = json.loads(msg.value)
                await self._dispatch(event)
                await consumer.commit()
        finally:
            await consumer.stop()

    async def _dispatch(self, event: dict):
        severity = event["severity"]
        applicant_id = event["applicant_id"]
        warning_type = event["warning_type"]

        if severity == "RED":
            # 기한이익상실 자동 검토 + 즉시 알림
            await self._trigger_acceleration_review(applicant_id, warning_type)
            await self._notify_risk_team(applicant_id, severity, warning_type)
        elif severity == "AMBER":
            # 차기 연장 시 자동 등급 하향 예약
            await self._schedule_grade_downgrade(applicant_id)
            await self._reserve_rate_premium(applicant_id, premium_bps=150)
        elif severity == "YELLOW":
            # 모니터링 강화 플래그
            await self._set_enhanced_monitoring(applicant_id)
```

### 8.4 감사 로그 (Kafka at-least-once + RDBMS Fallback)

```python
# backend/app/security/audit_logger.py
from aiokafka import AIOKafkaProducer
from aiokafka.errors import KafkaError
from sqlalchemy.ext.asyncio import AsyncSession
import json, uuid

class AuditLogger:
    """
    감사 로그 at-least-once 보장.
    Primary: Kafka (acks=all, replication=3)
    Fallback: PostgreSQL audit_logs 직접 동기 기록
    Chain-of-Custody: transaction_id로 피처 스냅샷·스코어·결정 연결
    """
    def __init__(self, producer: AIOKafkaProducer, db: AsyncSession):
        self._producer = producer
        self._db = db

    async def log_scoring_event(
        self,
        transaction_id: str,
        applicant_id: str,
        features_snapshot: dict,
        score: int,
        decision: str,
        rejection_reasons: list[str],
        model_version: str,
        user_id: str,
    ) -> None:
        payload = {
            "transaction_id": transaction_id,
            "applicant_id": applicant_id,
            "features_snapshot": features_snapshot,
            "score": score,
            "decision": decision,
            "rejection_reasons": rejection_reasons,
            "model_version": model_version,
            "user_id": user_id,
        }
        try:
            await self._producer.send_and_wait(
                "css.audit.scoring",
                key=transaction_id.encode(),
                value=json.dumps(payload).encode(),
            )
        except KafkaError:
            # Kafka 장애 시 RDBMS 직접 동기 기록 (Fallback)
            await self._db.execute(
                "INSERT INTO audit_logs_fallback (transaction_id, payload, created_at) "
                "VALUES (:tid, :payload, NOW())",
                {"tid": transaction_id, "payload": json.dumps(payload)},
            )
            await self._db.commit()
```

### 8.5 칼리브레이션 모니터링

```python
# backend/app/monitoring/calibration_monitor.py
import numpy as np
from sklearn.calibration import calibration_curve

class CalibrationMonitor:
    """
    분기별 Brier Score + ECE 산출.
    ECE > 0.02 시 모델팀 자동 알림.
    """
    def compute_ece(self, y_true: np.ndarray, y_prob: np.ndarray, n_bins: int = 10) -> float:
        """Expected Calibration Error"""
        bin_boundaries = np.linspace(0, 1, n_bins + 1)
        ece = 0.0
        for i in range(n_bins):
            mask = (y_prob > bin_boundaries[i]) & (y_prob <= bin_boundaries[i + 1])
            if mask.sum() == 0:
                continue
            avg_confidence = y_prob[mask].mean()
            avg_accuracy = y_true[mask].mean()
            ece += mask.sum() * abs(avg_confidence - avg_accuracy)
        return ece / len(y_true)

    def compute_brier(self, y_true: np.ndarray, y_prob: np.ndarray) -> float:
        return float(np.mean((y_prob - y_true) ** 2))

    async def run_quarterly_check(self, model_type: str) -> dict:
        # DB에서 최근 분기 실제 부도 이력 + 모델 예측 확률 조회
        y_true, y_prob = await self._fetch_quarterly_data(model_type)
        brier = self.compute_brier(y_true, y_prob)
        ece = self.compute_ece(y_true, y_prob)
        if ece > 0.02:
            await self._alert_model_team(model_type, ece, brier)
        return {"model_type": model_type, "brier_score": brier, "ece": ece}
```

---

## 9. 마일스톤 및 대금 지급

| 마일스톤 | 완료 시점 | 조건 | 비율 |
|---------|---------|------|------|
| M0 킥오프 완료 | 2026.04 | BRMS 기초 + DB 스키마 + Vault 구축 확인 | 10% |
| M1 ML 파이프라인 | 2026.07 | 5종 모형 OOT Gini ≥ 0.30, ECE ≤ 0.02 | 10% |
| M2 핵심 엔진 | 2026.09 | TC-REG-001~014 전건 통과, 골든케이스 ≥ 95% | 15% |
| M3 Release 1 완성 | 2026.11 | API + XAI + 이의제기 + 성능 (P95 ≤ 500ms) | 15% |
| M4 대안 데이터 | 2027.01 | SOHO 대안 모형 + Alt-data 파이프라인 운영 | 10% |
| M5 EWS + 스트레스 | 2027.03 | EWS 통합 + NPL 모형 + 스트레스 테스트 | 10% |
| M6 보안 완료 | 2027.04 | OWASP 0건 + Red Team 통과 + ISMS-P 점검 | 10% |
| M7 검증 완료 | 2027.06 | TC-REG 전건 + UAT ≥ 95% + MRM 문서 납품 | 10% |
| M8 운영 이관 | 2027.07 | KT 완료, 현업 팀장 서명 | 5% |
| M9 안정화 | 2027.09 | 3개월 P1 0건, SLA 99.9% | 5% |
| **합계** | | | **100%** |

---

## 10. 리스크 레지스터

| # | 리스크 | 가능성 | 영향 | 조기징후 | 완화 방안 |
|---|--------|------|------|---------|---------|
| R1 | 스트레스 DSR Phase 3 세부 조건 추가 발표 | 높음 | 높음 | 금융위 공지 | BRMS 골든케이스 자동 회귀테스트, 5영업일 반영 SLA |
| R2 | 카드사·VAN API 계약 지연 (대안 데이터) | 중 | 중 | 계약 협상 6개월 이상 소요 | Phase 4를 합성 데이터로 선행 개발, API 연동은 후속 |
| R3 | Vault(KMS) 가용성 장애 | 낮음 | 높음 | 키 조회 에러율 상승 | Vault HA 클러스터 + 로컬 캐시(TTL 1시간) Fallback |
| R4 | EWS 인터페이스 명세 지연 | 중 | 중 | EWS 담당팀 미착수 | Mock EWS 구현으로 CSS 선행 개발, 인터페이스 별도 추적 |
| R5 | 대안 데이터 품질 불량 | 중 | 중 | Sub-model PSI 급등 | 데이터 품질 검증 파이프라인 + 자동 폴백(α→1.0) |
| R6 | Red Team 테스트 대규모 지적 | 낮음 | 높음 | 이전 OWASP 진단 결과 | Phase 6에 4주 확보, Critical 조치 완료 전 M7 진행 금지 |
| R7 | 핵심 인력 이탈 (ML 리드) | 낮음 | 높음 | 이직 신호 | MRM 문서·코드 리뷰 2인 원칙, 지식 이전 의무화 |
| R8 | 규제 칼리브레이션 ECE 초과 | 중 | 중 | 분기 보고서 | Platt Scaling 자동 보정 파이프라인 사전 구축 |

**일정 버퍼**: 전체 18개월 중 6주 분량 버퍼 확보 (Phase 7~8 조정 가능)

---

## 11. KPI 측정 계획

### 11.1 재무 관점 KPI

| KPI | 목표 | 측정 주기 | 담당 |
|-----|------|---------|------|
| 포트폴리오 RAROC | ≥ 12% (허들레이트) | 월별 | 리스크팀 |
| RAROC 성장률 | AS-IS 대비 연 +15% | 분기 | 여신총괄 |
| 대안 데이터 기반 승인 비중 | SOHO 신규 취급 중 30% | 분기 | 여신팀 |
| 씬파일러 신규 고객 수 | 전체 신규 대출의 5% 이상 | 분기 | 여신팀 |

### 11.2 내부 프로세스 KPI

| KPI | 목표 | 측정 주기 |
|-----|------|---------|
| 규제 반영 Time-to-Market | 법령 공포 후 ≤ 1영업일 적용 | 사건 발생 시 |
| 자동 처리율 | ≥ 80% (승인+거절 자동) | 일별 |
| 금리 산정내역서 생성 지연 | P95 ≤ 500ms | 실시간 |
| 이의제기 처리기한 준수율 | 100% (10영업일) | 월별 |

### 11.3 보안·규제 KPI

| KPI | 목표 | 측정 주기 |
|-----|------|---------|
| 감사 로그 유실 건수 | 0건 | 월별 |
| 개인정보 오남용 지적 건수 | 0건 | 분기 |
| 하드컷 위반율 | 0% | 실시간 |
| AI Red Team 방어율 | 100% (모든 시도 차단·탐지) | 분기 |

### 11.4 모델 품질 KPI

| KPI | 목표 | 측정 주기 |
|-----|------|---------|
| Application Scorecard OOT Gini | ≥ 0.30 | 분기 |
| Brier Score | ≤ 기준선 대비 개선 | 분기 |
| ECE | ≤ 0.02 | 분기 |
| Score PSI | < 0.10 (목표) | 월별 |
| 빈티지 3개월 DPD30+ 이탈 | 기준 코호트 +20% 이내 | 월별 |
| PSI 경보 RCA 완료율 | 100% (10영업일 이내) | 사건 발생 시 |

---

*본 문서는 Korea Credit Scoring System (KCS) SI 구현을 위한 상세 계획서입니다.*
*v2.0 기준일: 2026-02-27*
*다음 개정 예정: Phase 0 킥오프 완료 후 v2.1 (인력 확정 반영)*
